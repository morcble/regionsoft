var Region={debugMode:function(){return true},wrapRegionFormParas:function(e,t){if($(e).length>1){alert("Unexpected region form found : duplicate region :"+e);return}var a=$($(e)[0]).parent();var i=a.attr("class");if(i!=undefined){t.clear();var r=a.attr("region-id");t.put("regionCompUuid",r);var n=a.attr("region-url");if(n!=undefined){Region.fillParamap(n,t);setUrlParametersToBindAttr(e,t);return}}setUrlParametersToBindAttr(e,t);return},wrapRegionGridParas:function(e,t){if($(e).length>1){alert("Unexpected region grid found : duplicate region :"+e);return}var a=$($(e)[0]).parent();var i=a.attr("class");if(i!=undefined){t.clear();var r=a.attr("region-id");t.put("regionCompUuid",r);var n=a.attr("region-url");if(n!=undefined){Region.fillParamap(n,t);setUrlParametersToBindAttr(e,t);return}}setUrlParametersToBindAttr(e,t);return},getUrlParaMap:function(){var e=new HashMap;var t=location.search.substr(1);var a=t.split("&");if(a){for(var i=0;i<a.length;i++){var r=a[i].substring(0,a[i].indexOf("="));if(r==null||r=="")continue;e.put(a[i].substring(0,a[i].indexOf("=")),a[i].substring(a[i].indexOf("=")+1))}}return e},fillParamap:function(e,t){var a=e.indexOf("?");if(a!=-1){var i=e.substring(a+1).split("&");for(var r=0;r<i.length;r++){var n=i[r].split("=");t.put(n[0],n[1])}}},ajaxRequestJson:function(e,t,a,i,r,n,o){if(n==null){n=true}var s=new Object;s.token=SystemData.getAppData().tokenId;s.requestId=getUUID2();SystemData.getAppData().lastAccessTime=(new Date).getTime();var l=new Object;l.data=JSON.stringify(i);l.webHeader=s;var d=new Object;d.requestStr=JSON.stringify(l);var p="unknown";if(e!=null&&e.regionId!=null)p=e.regionId;if(Region.debugMode)console.log(p+":Sending data to server:"+d.requestStr);$.ajax({url:t,type:a,data:d,cache:false,async:n,success:function(e,t){if(Region.debugMode)console.log(p+":revceived data from server:");if(Region.debugMode)console.log(e);if(typeof r==="function"){r(e,i,o)}},error:function(e,t,a){console.log(p+":revceived error from server:"+t+";requestId:"+s.requestId);console.log(e);alert("System Error: "+s.requestId)},complete:function(e,t){}})},ajaxGetStaticPage:function(e,t,a){var i=regionCache.get(e);if(i!=null){Region.renderCompRegion(i,a);return}if(t==null){t=false}$.ajax({url:e,type:"GET",data:null,cache:true,async:t,success:function(e,t){if(this.url.indexOf(".jsp")!=-1||this.url.indexOf(".html")!=-1){if(!devMode){regionCache.set(this.url,e,6)}}Region.renderCompRegion(e,a)},error:function(e,t,a){alert("System Error for get static page")},complete:function(e,t){}})},renderCompRegion:function(e,t){var a=getUUID();e=e.replace(/region-form/g,"region-form-"+a);e=e.replace(/region-grid/g,"region-grid-"+a);t.html(e);t.removeClass("hide")},fixEvent:function(e){return e?e:window.event},getRegionContainer:function(e){var t=$(e).attr("region-id");var a=window.regions["region_grid_"+t];if(a==undefined){return window.regions["region_form_"+t]}return a},getRegionContainerByEvent:function(e){e=Region.fixEvent(e);var t=$(e.srcElement);console.log(t);return Region.getRegionContainer(t)},getRegionContainerById:function(e){var t=window.regions["region_grid_"+e];if(t==undefined)t=window.regions["region_form_"+e];return t},loadRegion:function(e,t,a){if(e==null||e.length==0)return;e.addClass("hide");if(isEmpty(a)){a=getUUID()}e.attr("region-id",a);var i=t.indexOf("?");var r=null;if(i!=-1){r=t.substring(0,i);t+="&region-id="+a}else{r=t;t+="?region-id="+a}e.attr("region-url",t);e.attr("id",e.attr("id")+"-"+a);var n=new jQuery.Deferred;if(window.regionDef==undefined){window.regionDef=new Object}window.regionDef["afterRenderData_"+a]=n;n.promise();Region.ajaxGetStaticPage(frontEndPath+r,true,e);return n},createXMLHTTPRequest:function(){var e;if(window.XMLHttpRequest){e=new XMLHttpRequest;if(e.overrideMimeType){e.overrideMimeType("text/xml")}}else if(window.ActiveXObject){var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var a=0;a<t.length;a++){try{e=new ActiveXObject(t[a]);if(e){break}}catch(e){}}}return e},addRegionUniqueId:function(e,t){if(e.attr("region-id")==undefined){e.attr("region-id",t)}if(e.attr("path")!=undefined){return}var a=e.children();for(var i=0;i<a.length;i++){if($(a[i]).attr("region-id")==undefined){$(a[i]).attr("region-id",t)}Region.addRegionUniqueId($(a[i]),t)}}};var coverPageShow=false;function isEmpty(e){if(e==undefined||e==null||e.trim()=="")return true;else return false}function loadingStart(){var e={x:0,y:0};var t={p_margin:.4};if(window.innerWidth){e.x=window.innerWidth}else if(document.body&&document.body.clientWidth){e.x=document.body.clientWidth}if(window.innerHeight){e.y=window.innerHeight}else if(document.body&&document.body.clientHeight){e.y=document.body.clientHeight}$("#loadingContent").css("margin-top",e.y*t.p_margin);$("#loadingContent").removeClass("hide");$("#loadingDiv").removeClass("hide");coverPageShow=true}function loadingComplete(){$("#loadingContent").addClass("hide");$("#loadingDiv").addClass("hide");coverPageShow=false}var regionCache={now:function(){return(new Date).valueOf()},set:function(e,t,a){var i={ttl:1*60*60*1e3,now:regionCache.now(),value:t};if(typeof a=="number"&&a>0){i.ttl=a*1e3}localStorage.setItem(e,JSON.stringify(i))},get:function(e){var t=JSON.parse(localStorage.getItem(e));if(!t){return null}else if(t.ttl&&t.ttl+t.now<regionCache.now()){localStorage.removeItem(e);return null}return t.value},remove:function(e){localStorage.removeItem(e)},empty:function(e){localStorage.clear()}};function collapseToggle(e){e.find(".collapsePanel").click(function(){var e=$(this).closest(".panel-heading");var t=e.siblings(".panel-body");$(this).toggleClass("fa-minus fa-plus");t.toggleClass("collapse");e.find("span.panel-heading-sub-hide").toggleClass("hide")})}function refreshMessage(jqueryObj){var msgEles=jqueryObj.find("message");for(var i=0;i<msgEles.length;i++){var keyVal=$(msgEles[i]).attr("key");var text=eval(keyVal);$(msgEles[i]).replaceWith(text)}}function clone(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;t.setTime(e.getTime());return t}if(e instanceof Array){var t=[];for(var a=0,i=e.length;a<i;++a){t[a]=clone(e[a])}return t}if(e instanceof Object){var t={};for(var r in e){if(e.hasOwnProperty(r))t[r]=clone(e[r])}return t}throw new Error("Unable to copy obj! Its type isn't supported.")}function copyObj(e,t){if(e instanceof Object){for(var a in e){t[a]=e[a]}}}var fileList=new HashMap;var processingFileId=null;var processingFileReq=null;var fileFunction={uploadFile:function(e,t){var t=Region.fixEvent(t);var a=$(t.target);if(a.get(0).files[0]==undefined)return;if(e!=undefined){e=parseInt(e)*1024}else{e=4096*1024}if(a.get(0).files[0].size>e){popupValidateInfo.empty();popupValidateInfo.addErrorInfo(["Attachment file size exceeds the maximum limit 4 MB. Please try again."]);return}var i=[".doc",".xls",".ppt",".pdf",".jpg",".bmp",".gif",".tiff",".txt",".mdi",".tif",".msg",".htm",".mht",".docx",".xlsx",".msg"];var r=0,n=false;for(r=0;r<i.length;r++)if(a.get(0).files[0].name.indexOf(i[r])!=-1)n=true;if(n==false){popupValidateInfo.empty();popupValidateInfo.addErrorInfo(["File type is not supported"]);return}var o=getRegionContainerByEvent(t);var s=o.regionId+":"+a.attr("region-attr");fileList.put(s,a);a.parent().find(".deleteBtn").addClass("hide");a.parent().find(".attachBtn").addClass("hide");fileFunction.processingFile(s)},attachFile:function(e){$(e).parent().find("input[type=file]").click()},onprogress:function(evt){var loaded=evt.loaded;var tot=evt.total;var per=Math.floor(100*loaded/tot);fileList.get(processingFileId).parent().find(".abortBtn").removeClass("hide");fileList.get(processingFileId).parent().find(".fileInfo").html(per+"%");if(per==100){var tmpObj=fileList.get(processingFileId);var attachFileElem=tmpObj.get(0).files[0];tmpObj.parent().find(".abortBtn").addClass("hide");tmpObj.parent().find(".deleteBtn").removeClass("hide");tmpObj.parent().find(".attachBtn").prop("title","Update");tmpObj.parent().find(".attachBtn").removeClass("hide");tmpObj.parent().find(".fileInfo").html(attachFileElem.name);tmpObj.parent().find(".fileInput").val(attachFileElem.name);tmpObj.attr("orignalFile",attachFileElem.name);var uploadedCallBack=eval(tmpObj.attr("uploadedCallBack"));if(uploadedCallBack!=undefined&&typeof uploadedCallBack==="function"){uploadedCallBack(tmpObj.parent())}fileList.remove(processingFileId);processingFileId=null;processingFileReq=null;if(fileList.size()>0){var fileId=fileList.keySet().get(0);fileFunction.processingFile(fileId)}}},processingFile:function(e){if(processingFileId==null){processingFileId=e;var t=fileList.get(processingFileId);var a=t.get(0).files[0];var i=new FormData;i.append("upfile",a);var r=SystemData.getAppData();r.requestId=getUUID2();i.append("appData",JSON.stringify(r));i.append("paras",t.attr("paras"));console.log(backendPath+"/common/file/upload");processingFileReq=$.ajax({type:"POST",url:backendPath+"/common/file/upload",data:i,processData:false,contentType:false,xhr:function(){var e=$.ajaxSettings.xhr();if(fileFunction.onprogress&&e.upload){e.upload.addEventListener("progress",fileFunction.onprogress,false);return e}}})}else{fileList.get(e).parent().find(".fileInfo").html("Pending")}},deleteFile:function(e){var t=$(e);t.parent().find(".fileInfo").html("");t.parent().find(".fileInput").val("");t.parent().find(".deleteBtn").addClass("hide");t.parent().find(".attachBtn").prop("title",t.parent().find("input[type=file]").attr("label"));t.parent().find("input[type=file]").val("");t.parent().find("input[type=file]").attr("orignalFile","")},abortUploading:function(e){if(processingFileReq!=null){processingFileReq.abort();processingFileReq=null;processingFileId=null;var t=$(e);t=t.parent().find("input[type=file]");var a=t.attr("orignalFile");if(a==null||a==undefined){a=""}t.parent().find(".fileInfo").html(a);t.parent().find(".fileInput").val(a);t.parent().find("input[type=file]").val("");if(a==""){t.parent().find(".attachBtn").val(t.attr("label"));t.parent().find(".attachBtn").removeClass("hide")}else{t.parent().find(".deleteBtn").removeClass("hide");t.parent().find(".attachBtn").val("Update");t.parent().find(".attachBtn").removeClass("hide");t.parent().find(".attachBtn").prop("title",t.parent().find("input[type=file]").attr("label"))}t.parent().find(".abortBtn").addClass("hide")}}};function setUrlParametersToBindAttr(e,t){var a=t.keySet();for(var i=0;i<a.length;i++){if(a[i]==""||a[i]==null)continue;$(e).find("[region-attr="+a[i]+"]").each(function(e,r){var n=$(this);if(n.get(0).tagName=="SPAN"){n.html(t.get(a[i]))}else{n.val(t.get(a[i]))}})}}function renderPaginationControl(e,t,a,i,r,n,o){if(t.length==0)return;if(a==0){t.find(".control").html("");t.find(".info").html("");return}var s={totalPageAmount:parseInt(r),currentPageNo:parseInt(i),pageBtnShowAmount:parseInt(o)?parseInt(o):9,pageBtnShowStart:null,pageBtnShowEnd:null,pageExtendBtnLeftShow:false,pageExtendBtnRightShow:false,template:$("<button>").addClass("btn btn-default btn-sm")};var l='<div class="btn-group">';if(s.totalPageAmount>s.pageBtnShowAmount){var d=parseInt(s.pageBtnShowAmount/2);s.pageBtnShowStart=s.currentPageNo-d;s.pageBtnShowEnd=s.pageBtnShowStart+s.pageBtnShowAmount-1;if(s.pageBtnShowStart<1){s.pageBtnShowStart=1;s.pageBtnShowEnd=s.pageBtnShowStart+s.pageBtnShowAmount-1}if(s.pageBtnShowEnd>s.totalPageAmount){s.pageBtnShowEnd=s.totalPageAmount;s.pageBtnShowStart=s.pageBtnShowEnd-s.pageBtnShowAmount+1}s.pageExtendBtnLeftShow=true;s.pageExtendBtnRightShow=true}else{s.pageBtnShowStart=1;s.pageBtnShowEnd=s.totalPageAmount}if(s.pageExtendBtnLeftShow){var p=s.template.clone().addClass("pageExtendBtn pageExtendBtnUp");p.append($("<i>").addClass("fa fa-angle-double-left"));l+=p.prop("outerHTML")}l+='<button class="btn btn-default btn-sm prePageBtn" title="Previous"><i class="fa fa-angle-left"></i></button>';for(var f=s.pageBtnShowStart;f<=s.pageBtnShowEnd;f++){var p=s.template.clone().attr("pageNo",f).addClass("pageIndexBtn").text(f);if(f==s.currentPageNo){p.addClass("pageIndexBtnCurrent")}l+=p.prop("outerHTML")}l+='<button class="btn btn-default btn-sm nextPageBtn" title="Next"><i class="fa fa-angle-right"></i></button>';if(s.pageExtendBtnRightShow){var p=s.template.clone().addClass("pageExtendBtn pageExtendBtnDown");p.append($("<i>").addClass("fa fa-angle-double-right"));l+=p.prop("outerHTML")}e.requestData.pageNumberBtns=r;l+='<button class="btn btn-default btn-sm refreshBtn">Refresh</button>';l+="</div>";l+='<div class="pagination-option">';l+='<select class="btn btn-default btn-sm pageSizeSelect">';l+='<option value="15">15</option>';l+='<option value="30">30</option>';l+='<option value="45">45</option>';l+='<option value="100">100</option>';l+="</select>";l+='<span class="text-normal">per page</span>';l+="</div>";l+='<div class="pagination-go">';l+='<input type="text" placeholder="page no" class="form-control input-sm redirectPageInput goPageId numberOnly"/>';l+='<button class="btn btn-default btn-sm resetBtn redirectPageBtn">GO</button>';l+="</div>";t.find(".control").html(l);var g=t.find(".pageIndexBtn");for(var f=0;f<g.length;f++){$(g[f]).click(function(){e.gotoPage($(this).attr("pageNo"))})}t.find(".pageExtendBtn.pageExtendBtnUp").prop("disabled",parseInt(g.eq(0).attr("pageNo"))==1);t.find(".pageExtendBtn.pageExtendBtnDown").prop("disabled",parseInt(g.eq(g.length-1).attr("pageNo"))==s.totalPageAmount);t.find(".pageExtendBtn").click(function(){if($(this).hasClass("pageExtendBtnUp")){var a=s.currentPageNo-s.pageBtnShowAmount;a=a>1?a:1;e.gotoPage(a)}else if($(this).hasClass("pageExtendBtnDown")){var a=s.currentPageNo+s.pageBtnShowAmount;a=a<s.totalPageAmount?a:s.totalPageAmount;e.gotoPage(a)}t.find(".pageExtendBtn.pageExtendBtnUp").prop("disabled",parseInt(g.eq(0).attr("pageNo"))==1);t.find(".pageExtendBtn.pageExtendBtnDown").prop("disabled",parseInt(g.eq(g.length-1).attr("pageNo"))==s.totalPageAmount)});t.find(".pageSizeSelect").val(n);if(i<=1){t.find(".prePageBtn").attr("disabled",true)}else{t.find(".prePageBtn").attr("disabled",false)}if(i>=r){t.find(".nextPageBtn").attr("disabled",true)}else{t.find(".nextPageBtn").attr("disabled",false)}t.find(".refreshBtn").click(function(){e.refreshPage()});t.find(".prePageBtn").click(function(){e.prePage()});t.find(".nextPageBtn").click(function(){e.nextPage()});t.find(".redirectPageBtn").click(function(){e.redirectPage()});t.find(".redirectPageInput").keypress(function(){if(event.keyCode==13){event.preventDefault();e.redirectPage()}});t.find(".pageSizeSelect").change(function(){e.requestData.pageSize=$(this).val();e.refreshPage()});var u=t.find(".info");var c='&nbsp;<span class="text-normal totalAmountDis">0</span> <span class="text-normal">records found</span>&nbsp;&nbsp;<span class="text-normal">current page</span><span class="text-normal curPageDis">0</span> <span class="text-normal">/</span> <span class="text-normal totalPageDis">0</span>';u.html(c);u.find(".totalAmountDis").html(a);u.find(".curPageDis").html(i);u.find(".totalPageDis").html(r);u.find(".pageSizeSelect").val(n)}function getUUID(){var e=setTimeout("0");clearTimeout(e);return e}function getUUID2(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e=="x"?t:t&3|8;return a.toString(16)})}function fillTable(listTable,responseTO,currentPageNo,pageSize){var rows=listTable.find("tr");var sampleRow=null;var listData=null;for(var i=0;i<rows.length;i++){if(sampleRow==null){if($(rows[i]).attr("bind-list")!=null){sampleRow=$(rows[i]).html();listData=responseTO[$(rows[i]).attr("bind-list")]}}else{$(rows[i]).remove()}}if(sampleRow==null){return}if(listData==null){return}var appendTxt="";for(var i=0;i<listData.length;i++){var obj=listData[i];if(currentPageNo!=undefined&&pageSize!=undefined)obj["seqNo"]=i+1+(currentPageNo-1)*pageSize;else obj["seqNo"]=i+1;var str=sampleRow;for(var key in obj){var replaceReg=eval("/{{"+key+"}}/g");str=str.replace(replaceReg,obj[key])}str='<tr primaryKey="'+obj["id"]+'">'+str+"</tr>";str=str.replace(/{{\w*}}/g,"");appendTxt+=str}listTable.append(appendTxt)}function sampleValidation(e,t,a,i){var r=false;var n=e.getDomObjByBindAttribute(t);n.value=n.value.trim();if(n.value!=111){r=true}if(r){e.addFieldError(t,a,i)}else{e.removeFieldError(a)}return!r}var customDrag={init:function(e,t,a){e.css("cursor","move").on("mousedown",function(i){t.addClass("draggable");e.siblings().find("iframe").css("pointer-events","none");var r=t.outerHeight(),n=t.outerWidth(),o=t.offset().top+r-i.pageY,s=t.offset().left+n-i.pageX;a.on("mousemove",function(e){drag_center_y=e.pageY+o-r+t.outerHeight()/2;drag_center_x=e.pageX+s-n+t.outerWidth()/2;if(t.hasClass("draggable")){t.offset({top:e.pageY+o-r,left:e.pageX+s-n})}}).on("mouseup",function(){t.removeClass("draggable");e.siblings().find("iframe").css("pointer-events","auto")});i.preventDefault()}).on("mouseup",function(){})},reset:function(e,t,a){e.off();e.siblings().find("iframe").css("pointer-events","auto");t.off();t.css({top:0,left:0}).removeClass("draggable");a.off()}};var customResize={init:function(e,t){var a=e.find("iframe").eq(0);e.on("mousemove",function(t){e.css("cursor",function(){if(t.offsetX<0&&t.offsetY>0&&t.offsetY<e.innerHeight()){return"w-resize"}if(t.offsetX>e.innerWidth()&&t.offsetY>0&&t.offsetY<e.innerHeight()){return"e-resize"}if(t.offsetX>0&&t.offsetX<e.innerWidth()&&t.offsetY>e.innerHeight()){return"s-resize"}if(t.offsetX>e.innerWidth()&&t.offsetY>e.innerHeight()){return"se-resize"}if(t.offsetX<0&&t.offsetY>e.innerHeight()){return"sw-resize"}return"auto"})}).on("mousedown",function(i){e.addClass("resizeable");a.css("pointer-events","none");var r=a.innerHeight(),n=e.innerWidth(),o=i.pageY,s=i.pageX;t.css("cursor",e.css("cursor")).on("mousemove",function(i){if(e.hasClass("resizeable")&&t.css("cursor").split("-")[1]=="resize"){var l=t.css("cursor").split("-")[0];if("w"==l){e.width(n+(-i.pageX+s)*2);a.width(n+(-i.pageX+s)*2-2)}if("e"==l){e.width(n+(i.pageX-s)*2);a.width(n+(i.pageX-s)*2-2)}if("s"==l){a.height(r+i.pageY-o)}if("se"==l){e.width(n+(i.pageX-s)*2);a.width(n+(i.pageX-s)*2-2).height(r+i.pageY-o)}if("sw"==l){e.width(n+(-i.pageX+s)*2);a.width(n+(-i.pageX+s)*2-2).height(r+i.pageY-o)}}}).on("mouseup",function(){e.removeClass("resizeable");t.css("cursor","auto");a.css("pointer-events","auto")});i.preventDefault()}).on("mouseup",function(i){e.removeClass("resizeable");t.css("cursor","auto");a.css("pointer-events","auto")})},reset:function(e,t){e.off();e.removeClass("resizeable");e.find("iframe").eq(0).css("pointer-events","auto");t.off();t.css("cursor","auto")}};var iframe;var lock=false;function openModalWindow(e,t,a,i,r){if(lock)return;lock=true;var n={small:{x:600,y:450,p:0},medium:{x:800,y:500,p:.5},large:{x:1e3,y:600,p:.95}};if(r){n[r.type]={x:r.x?r.x:n[r.type].x,y:r.y?r.y:n[r.type].y,p:r.p?r.p:n[r.type].p}}if(!a||n[a]==undefined){a="large"}var o={x:0,y:0,specialHeader:false,specialHeaderMargin:80};var s={x:0,y:0,margin:0,p_margin:.4,fix_heading:i?80:45,fix_border:5};if(window.innerWidth){o.x=window.innerWidth}else if(document.body&&document.body.clientWidth){o.x=document.body.clientWidth}if(window.innerHeight){o.y=window.innerHeight}else if(document.body&&document.body.clientHeight){o.y=document.body.clientHeight}$("#popUpProgress").css("margin-top",o.y*s.p_margin);if($("#popUpCover").closest("body").find(".top-menu-dynamic").length>0){o.specialHeader=true;var l=document.documentElement.scrollTop||document.body.scrollTop;if(l>=o.specialHeaderMargin){o.specialHeader=false}else{o.specialHeaderMargin=o.specialHeaderMargin-l}}if(o.specialHeader){o.y=o.y>o.specialHeaderMargin?o.y-o.specialHeaderMargin:o.y}o.y=o.y>s.fix_heading?o.y-s.fix_heading:o.y;s.x=n[a].x<o.x?n[a].x:o.x;s.y=n[a].y<o.y?n[a].y:o.y;if("small"==a){s.margin=s.y<o.y?(o.y-s.y)*s.p_margin:0}else if("medium"==a){s.x=s.x<o.x*n.medium.p?o.x*n.medium.p:s.x;s.y=s.y<o.y*n.medium.p?o.y*n.medium.p:s.y;s.margin=s.y<o.y?(o.y-s.y)*s.p_margin:0}else if("large"==a){s.x=s.x<o.x*n.large.p?o.x*n.large.p:s.x;s.y=s.y<o.y*n.large.p?o.y*n.large.p:s.y;s.margin=s.y<o.y?(o.y-s.y)*s.p_margin:0}if(o.specialHeader){s.margin=s.margin<o.specialHeaderMargin?o.specialHeaderMargin:s.margin}iframe=document.getElementById("popupContentIframe");$(".popUpDiv").width(s.x-2*s.fix_border);$(iframe).width(s.x-2*s.fix_border-2);$(iframe).height(s.y-s.fix_border);$("#popUpCover").find(".popUpDiv").css("margin-top",s.margin-s.fix_border);$(".popUpTitle").text(t);if(i){$(".popUpDiv").removeClass("popup-normal").addClass("popup-specialHeader")}else{$(".popUpDiv").removeClass("popup-specialHeader").addClass("popup-normal")}$(".popUpDiv").hide();$("body").addClass("popup-noscroll");$("#popUpProgress").show();iframe.onload=iframe.onreadystatechange=iframeload;iframe.src=e;$("#popUpCover").show();customDrag.init($(".popUpDiv").hasClass("popup-specialHeader")?$(".popUpDiv").children(".popup-header-special"):$(".popUpDiv").children(".panel").children(".panel-heading"),$(".popUpDiv"),$(".popUpDiv").closest(".popup_cover_div"));customResize.init($(".popUpDiv"),$(".popUpDiv").closest(".popup_cover_div"));lock=false}function iframeload(){if(!iframe.readyState||iframe.readyState=="complete"){$(".popUpDiv").show();$("#popUpProgress").hide()}}function closeModalWindow(){$("#popUpCover").hide();$("body").removeClass("popup-noscroll");customDrag.reset($(".popUpDiv").hasClass("popup-specialHeader")?$(".popUpDiv").children(".popup-header-special"):$(".popUpDiv").children(".panel").children(".panel-heading"),$(".popUpDiv"),$(".popUpDiv").closest(".popup_cover_div"));customResize.reset($(".popUpDiv"),$(".popUpDiv").closest(".popup_cover_div"))}function cleanFormAllError(){var e=this.validationErrors.values();for(var t=0;t<e.length;t++){e[t].cleanErrorMsg()}}function containAttr(e){for(var t in this){if(t==e){return true}}return false}function toggleTableDetail(e,t,a,i,r,n,o){i=fixEvent(i);var s=false;if($(i.target).hasClass("fa-plus")||$(i.target).hasClass("fa-minus")){$(i.target).toggleClass("fa-plus fa-minus")}else if($(i.target).children("i.fa-plus").length>0||$(i.target).children("i.fa-minus").length>0){$(i.target).children("i").toggleClass("fa-plus fa-minus")}var l=$(i.target).closest("tr");var d=getRegionContainer(l);var p=d.find(".listTable");if(o==undefined){o=0}var f="detailTr"+t+"_"+d.regionId+"_"+o;var g="."+f;p.find(".comp_"+t+"_"+d.regionId).each(function(e,t){var a=$(this);if(!a.hasClass(f))a.hide()});var u="innerCompLoad"+t+"_"+d.regionId+"_"+o;console.log(u);var c=p.find("#"+u);if(c.length!=0){if(p.find(g).css("display")!="none"){s=true}}if(!s){if(c.length==0){var h="";if(r!=undefined){h="<td colspan='"+r+"'> </td>"}var m="";if(n!=undefined){m="<td colspan='"+n+"'> </td>"}$('<tr class="tr-comp comp_'+t+"_"+d.regionId+" "+f+'" style="display:none">'+h+"<td colspan='"+a+"'><div include=\""+e+'" id="'+u+'"/></div></td>'+m+"</tr><tr style='display:none'><td></td></tr>").insertAfter(l);loadComp($("#"+u))}p.find(g).show()}else{p.find(g).hide()}}function renderDataLsByUrl(e,t,a){for(var i=0;i<e.length;i++){var r=e[i];var n={};n.indexNo=i;ajaxGetPageNoCover(backendPath+t,"POST",n,a.initDataLsCallback.bind(a,e),true)}}function getMsg(keyVal){var text=eval(keyVal);return text}var emptyReg=/^(\s*\S+\s*)+$/;var numberReg=/^[0-9]*$/;var mobileReg=/^1\d{10}$/;var phoneReg=/^0\d{2,3}-?\d{7,8}$/;var accountReg=/^[a-zA-z]\w{3,15}$/;var emailReg=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;var timeReg=/^(([0-1][0-9])|(2[0-3])):[0-5][0-9]$/;function getPos_X(e){var t=0;var a=e.offsetWidth;do{t=t+e.offsetLeft}while(e=e.offsetParent);return t+a}function getPos_Y(e){var t=0;do{t+=e.offsetTop}while(e=e.offsetParent);return t+5}function RegionForm(e,t,a,i,r){this.paraMap=Region.getUrlParaMap();Region.wrapRegionFormParas(e,this.paraMap);this.recordId=this.paraMap.get("recordId");if(!isEmpty(this.paraMap.get("region-id"))){r=this.paraMap.get("region-id")}else if(isEmpty(r)){r=getUUID()}else{r=r.trim()}if(window.regions==undefined){window.regions=new Object}window.regions["region_form_"+r]=this;this.regionId=r;this.regionDivObj=$(e);this.regionDivObj.attr("id","region-form-"+this.regionId);$('<div class="loadIcon"><div class="spin-loading spin-sm"></div></div>').insertBefore(this.regionDivObj.children()[0]);this.formParas=t;this.regArray=a;this.errorMsgArray=i;this.validationErrors=new HashMap;this.jsonDataBakup=null;this.jsonData=null;collapseToggle(this.regionDivObj);this.addRegionId(this.regionDivObj)}RegionForm.prototype.saveOrUpdateRegion=function(){if(typeof this.beforeValidate==="function"){if(Region.debugMode)console.log(this.regionId+":beforeValidate");var e=this.beforeValidate();if(false==e){if(Region.debugMode)console.log(this.regionId+":beforeValidate false in region:"+this.regionId);return}}if(this.validate()){this.editSCallback()}};RegionForm.prototype.saveOrUpdateRegionNoValidation=function(){if(typeof this.beforeValidate==="function"){if(Region.debugMode)console.log(this.regionId+":beforeValidate");var e=this.beforeValidate();if(false==e){if(Region.debugMode)console.log(this.regionId+":beforeValidate false in region:"+this.regionId);return}}this.editSCallback()};RegionForm.prototype.find=function(e){return this.regionDivObj.find(e)};RegionForm.prototype.editSCallback=function(){var e=this.packFormData();this.postTableData()};RegionForm.prototype.subEditSCallback=function(e){if(Region.debugMode)console.log(this.regionId+":afterRetrieveData");if(typeof this.afterRetrieveData==="function"){this.afterRetrieveData()}if(e.msg!=null&&e.success==false){if(this.isPopup){popupValidateInfo.addErrorInfo([e.msg])}else{if(typeof topValidateInfo!=undefined){}}}if(e.success==false){this.serverData=e;if(typeof this.saveFailedCallBack==="function"){this.saveFailedCallBack()}region_form_util.renderDataComplete.apply(this);return}else{this.jsonData=e.data;this.serverData=e;this.jsonDataBakup=null}this.renderData();if(typeof this.saveSuccessCallBack==="function"){this.saveSuccessCallBack()}};RegionForm.prototype.editCCallback=function(){this.renderData()};RegionForm.prototype.validate=function(){if(typeof topValidateInfo!=undefined){}if(this.disableValidaiton==true){return true}var e=true;for(var t=0;t<this.formParas.length;t++){var a=this.checkText(this.formParas[t],this.regArray[t],this.errorMsgArray[t]);if(e){e=a}}var i=new Array;if(this.validationErrors.size()>0){console.log(this.validationErrors.size()+" errors found");var r=this.validationErrors.keySet();for(var t=0;t<r.length;t++){if(this.validationErrors.get(r[t]).errorMsg!=undefined)i.push(this.validationErrors.get(r[t]).errorMsg)}loadingComplete()}if(this.isPopup){popupValidateInfo.empty();popupValidateInfo.addErrorInfo(i)}else{if(typeof topValidateInfo!=undefined){}}return e};RegionForm.prototype.postTableData=function(){if(Region.debugMode)console.log(this.regionId+":beforeRetrieveData");if(typeof this.beforeRetrieveData==="function"){this.beforeRetrieveData()}if(this.overridenResUrl!=undefined){Region.ajaxRequestJson(this,this.overridenResUrl,"POST",this.jsonData,this.subEditSCallback.bind(this),true,null)}else{Region.ajaxRequestJson(this,this.resUrl+"save/","POST",this.jsonData,this.subEditSCallback.bind(this),true,null)}};RegionForm.prototype.packFormData=function(){var e=new Object;this.packageNode(this.regionDivObj,this.regionId,e,"region-editable");this.jsonData=e;return this.jsonData};RegionForm.prototype.packageNode=function(e,t,a,i){var r=e.attr("region-id");if(r==undefined){if(e.attr("region-url")!=undefined){return}}else if(r!=t){return}var n=e.attr("region-attr");if(n!=undefined&&e.hasClass(i)&&n!=""&&n!="none"){this.packageAttribute(e,a,n)}var o=e.children();for(var s=0;s<o.length;s++){this.packageNode($(o[s]),t,a,i)}};RegionForm.prototype.packageAttribute=function(e,t,a){if(e.attr("type")=="radio"){if(e.attr("checked")=="checked"){t[a]=e.val()}}else if(e.attr("type")=="checkbox"){if(e.prop("checked")){var i=t[a];var r=null;if(i==null||i.trim()==""){r=new Array}else{r=JSON.parse(i)}r.push(e.val());t[a]=JSON.stringify(r)}}else if(e.get(0).tagName=="INPUT"&&e.attr("type")=="file"){t[a]=e.get(0).files[0].name}else{if(e.get(0).tagName=="SELECT"&&e.attr("multiple")){var n=new Array;e.find("> option").each(function(e,t){n.push($(t).val())});t[a]=JSON.stringify(n)}else{var o="";var s=typeof e.val();if(s=="string"){o=e.val().trim()}else if(s==undefined){}else{o=JSON.stringify(e.val())}if(o!=""){t[a]=o}else{t[a]=null}}}};RegionForm.prototype.getDomObjByBindAttribute=function(e){var t=this.regionDivObj;var a=$(t).find("[region-attr="+e+"]");for(var i=0;i<a.length;i++){if($(a[i]).hasClass("region-editable")){var r=a[i];return r}}};RegionForm.prototype.cleanFields=function(){var e=this.regionDivObj;var t=$(e).find("[region-attr]");for(var a=0;a<t.length;a++){var i=$(t[a]);if(i.attr("type")!="hidden"){i.val("")}}};RegionForm.prototype.checkText=function(e,t,a){if(t==null||t.length==0)return true;var i=this.getDomObjByBindAttribute(e);if(i==null)alert(e+" not found");var r="";var n=$(i).parent().prev().find(".mandatoryIcon").text();if(n==null||n==""){n=e}if($(i).attr("type")=="radio"){var o=this.find("input:radio[region-attr="+e+"]:checked");if(o!=null){r=o.val()}}else{i.value=i.value.trim();r=i.value}var s="RegionForm"+this.regionId+e+"_js_error";for(var l=0;l<t.length;l++){if(typeof t[l]==="function"){if(!t[l](this,e,s,a[l])){var d=this.validationErrors.get(s);if(d==null){d=new FieldError(e,s,a[l],this,n);this.validationErrors.put(s,d)}else{d.errorMsg=a[l]}d.showErrorMsg();return false}else{continue}}if(t[l].test(r)==false){var d=this.validationErrors.get(s);if(d==null){d=new FieldError(e,s,a[l],this,n);this.validationErrors.put(s,d)}else{d.errorMsg=a[l]}d.showErrorMsg();return false}else{continue}}if(this.validationErrors.containsKey(s)){this.validationErrors.get(s).cleanErrorMsg();this.validationErrors.remove(s)}return true};RegionForm.prototype.addFieldError=function(e,t,a){var i=new FieldError(e,t,a,this);this.validationErrors.put(t,i)};RegionForm.prototype.removeFieldError=function(e){if(this.validationErrors.containsKey(e)){this.validationErrors.get(e).cleanErrorMsg();this.validationErrors.remove(e)}};RegionForm.prototype.renderRegion=function(){if(typeof this.beforeRetrieveData==="function"){if(Region.debugMode)console.log(this.regionId+":beforeRetrieveData");this.beforeRetrieveData()}if(this.recordId==null||this.recordId==""){this.renderData()}else{if(this.overridenResUrl!=undefined){Region.ajaxRequestJson(this,this.overridenResUrl,"POST",this.recordId,this.retrieveDataCallBack.bind(this),true,null)}else{Region.ajaxRequestJson(this,this.resUrl+"get/"+this.recordId,"POST",this.recordId,this.retrieveDataCallBack.bind(this),true,null)}}};RegionForm.prototype.refreshRegion=function(){this.renderRegion()};RegionForm.prototype.retrieveDataCallBack=function(e){if(e.msg!=null)console.log(e.msg);if(e.flag=="F"){if(typeof this.afterRetrieveData==="function"){if(Region.debugMode)console.log(this.regionId+":afterRetrieveData");this.afterRetrieveData()}return}else{if(this.jsonData!=null){this.jsonDataBakup=this.jsonData}this.jsonData=e.data;if(typeof this.afterRetrieveData==="function"){if(Region.debugMode)console.log(this.regionId+":afterRetrieveData");this.afterRetrieveData()}this.renderData()}};RegionForm.prototype.renderNode=function(e,t,a,i){var r=e.attr("region-id");if(r==undefined){if(e.attr("region-url")!=undefined){return}}else if(r!=t){return}var n=e.attr("region-attr");e.attr("region-id",t);if(n!=undefined){this.renderAttribute(e,t,a,i,n)}var o=e.children();for(var s=0;s<o.length;s++){this.renderNode($(o[s]),t,a,i)}};RegionForm.prototype.renderAttribute=function(targetNode,regionId,paraData,selectDomArray,regionAttr){var tmp=null;if(paraData!=null){tmp=paraData[regionAttr]}if(tmp==null)tmp="";var tmpObj=targetNode;var dataLs=tmpObj.attr("dataLs");if(dataLs!=null){selectDomArray.push(tmpObj);tmpObj.selectValue=tmp;return}if(tmpObj.hasClass("date")){if(tmpObj.attr("fromds")=="true"){return}var timepickerSelector="timePicker"+bindAttr+this.regionId;var replaceTxt=' <div class="'+timepickerSelector+' input-group date">';replaceTxt+=tmpObj.prop("outerHTML");
replaceTxt+='<span class="input-group-addon hover-pointer">';replaceTxt+='<i class="fa fa-calendar"></i>';replaceTxt+="</span>";replaceTxt+="</div>";tmpObj.replaceWith(replaceTxt);tmpObj=$(tableObj).find("[bind-attr="+bindAttr+"]");var defaultDatepickerOptions={maxViewMode:"century",todayBtn:"linked",autoclose:true,todayHighlight:true,zIndexOffset:1e4};var tmpDatepickerOptions={};tmpDatepickerOptions.format=tmpObj.attr("dateformat");tmpDatepickerOptions.startDate=tmpObj.attr("startDate");tmpDatepickerOptions.endDate=tmpObj.attr("endDate");$.extend(defaultDatepickerOptions,tmpDatepickerOptions);this.find("."+timepickerSelector).datepicker(defaultDatepickerOptions);tmpObj.attr("fromds","true");this.find("."+timepickerSelector).datepicker("setDate",tmp);return}if(tmpObj.get(0).tagName=="INPUT"&&tmpObj.attr("type")=="file"){if(tmpObj.attr("fromds")=="true")return;var outerHtml=tmpObj.prop("outerHTML");var replaceTxt="<span>\r\n";replaceTxt+=outerHtml;replaceTxt+='<span class="fileInfo"></span>';replaceTxt+='<input type="text" class="EDIT_MODE fileInput hide"/>';replaceTxt+='<a class="abortBtn hover-pointer hide" title="Cancel" onclick="fileFunction.abortUploading(this);"><i class="fa fa-fw fa-remove fa-lg"></i></a>';replaceTxt+='<a class="attachBtn hover-pointer" onclick="fileFunction.attachFile(this);"><i class="fa fa-fw fa-paperclip fa-lg"></i></a>';replaceTxt+='<a class="deleteBtn hover-pointer hide" title="Delete" onclick="fileFunction.deleteFile(this)"><i class="fa fa-fw fa-trash fa-lg"></i></a>';replaceTxt+="</span>";tmpObj.replaceWith(replaceTxt);tmpObj=$(tableObj).find("[region-attr="+regionAttr+"]");tmpObj.addClass("hide");tmpObj.change(function(e){fileFunction.uploadFile(e)});tmpObj.parent().find(".fileInput").attr("region-attr",regionAttr);tmpObj.parent().find(".attachBtn").prop("title",tmpObj.attr("label"));var paras=new HashMap;var functionStr="var tmpFuc = function(){ "+tmpObj.attr("renderCallBack")+"};tmpFuc.call(this);";eval(functionStr);if(paras.get("caseId")!=null){var tmpCaseData=getAppCache(paras.get("caseId"));paras.put("caseNumber",tmpCaseData.caseNumber)}var keySets=paras.keySet();var appendParas=tmpObj.attr("paras");for(var tmpIndex=0;tmpIndex<keySets.length;tmpIndex++){var tmpKey=keySets[tmpIndex];appendParas+=";"+tmpKey+"=";appendParas+=paras.get(tmpKey)}tmpObj.attr("paras",appendParas);if(tmp!=""){tmpObj.attr("orignalFile",tmp);tmpObj.parent().find(".fileInput").val(tmp);tmpObj.parent().find(".fileInfo").html(tmp);tmpObj.parent().find(".deleteBtn").removeClass("hide");tmpObj.parent().find(".attachBtn").prop("title","Update")}tmpObj.attr("fromds","true");return}else if(tmpObj.get(0).tagName=="INPUT"&&tmpObj.attr("type")=="checkbox"){if(tmpObj.attr("fromds")=="true"){if(tmp!=null&&tmp.trim()!=""){var tmpAttrObj=JSON.parse(tmp);for(var j=0;j<tmpAttrObj.length;j++){if(tmpAttrObj[j]==tmpObj.val()){tmpObj.prop("checked","true");break}if(j==tmpAttrObj.length-1){tmpObj.prop("checked",false)}}}return}}else if(tmpObj.get(0).tagName=="INPUT"&&tmpObj.attr("type")=="radio"){if(tmpObj.attr("fromds")=="true"){if(tmp==tmpObj.val()){tmpObj.prop("checked","true")}return}}if(tmpObj.get(0).tagName=="SELECT"&&!tmpObj.attr("multiple")){if(tmpObj.attr("fromds")=="true"){if(tmp!=null&&tmp.trim()!=""){tmpObj.val(tmp)}return}}else{if(paraData!=null){if(tmpObj.get(0).tagName=="SPAN"){tmpObj.html(tmp)}else{if(tmpObj.attr("fromds")=="true"){return}tmpObj.val(tmp)}}}};RegionForm.prototype.renderData=function(){if(Region.debugMode)console.log(this.regionId+":beforeRenderData");if(typeof this.beforeRenderData==="function"){this.beforeRenderData()}var tmpData=clone(this.jsonData);var selectDomArray=new Array;this.renderNode(this.regionDivObj,this.regionId,tmpData,selectDomArray);var dsDefArray=new Array;for(var i=0;i<selectDomArray.length;i++){var tmpObj=selectDomArray[i];var tmpReqObj={};tmpReqObj.indexNo=i;tmpReqObj.entityClass=tmpObj.attr("entityClass");tmpReqObj.filterVal=tmpObj.attr("dataLs");tmpReqObj.filterColumn=tmpObj.attr("filterColumn");tmpReqObj.optionLabel=tmpObj.attr("optionLabel");tmpReqObj.optionValue=tmpObj.attr("optionValue");tmpReqObj.orderBy=tmpObj.attr("orderBy");var tmpLs=tmpObj.attr("dataLs");var lsObj=DropdownList.get(tmpLs);if(lsObj!=null){var tmpArray=new Array;for(var j=0;j<lsObj.length;j++){var newObj={};newObj.indexNo=i;for(tmpAttr in lsObj[j]){newObj.desc=lsObj[j][tmpAttr];newObj.value=tmpAttr}tmpArray.push(newObj)}this.initDataLsWithArray(selectDomArray,tmpArray)}else{var jqueryDef=new jQuery.Deferred;jqueryDef.promise();dsDefArray.push(jqueryDef);Region.ajaxRequestJson(this,backendPath+"/common/select/getOptions","POST",tmpReqObj,this.initDataLsCallback.bind(this,selectDomArray),true,jqueryDef)}}var regionTmp=this;if(dsDefArray.length>0){var defStr="";for(var j=0;j<dsDefArray.length;j++){defStr+="dsDefArray["+j+"]";if(j!=dsDefArray.length-1){defStr+=","}}var tmpJs="$.when("+defStr+").then(function(){region_form_util.renderDataComplete.apply(regionTmp);})";eval(tmpJs)}else{region_form_util.renderDataComplete.apply(regionTmp)}};RegionForm.prototype.hideLoading=function(){this.show();this.regionDivObj.find(".loadIcon").hide()};RegionForm.prototype.addRegionId=function(e){Region.addRegionUniqueId(e,this.regionId)};RegionForm.prototype.initDataLsCallback=function(e,t,a,i){var r=t["data"];this.initDataLsWithArray(e,r);i.resolve()};RegionForm.prototype.initDataLsWithArray=function(selectDomArray,array){this.dsCacheMap=SystemData.getAppData().dsCacheMap;if(this.dsCacheMap==null){this.dsCacheMap=new HashMap}if(array.length==0)return;var indexNo=array[0].indexNo;var tmpObj=selectDomArray[indexNo];var dataLsKey=tmpObj.attr("dataLs");var useCache=true;var entityClass=tmpObj.attr("entityClass");if(entityClass!=undefined)useCache=false;var tmpOption=$("<option>");if(tmpObj.get(0).tagName=="SELECT"){if(!tmpObj.attr("multiple")||tmpObj.selectValue==""){tmpObj.removeAttr("dataLs");var tmpAppendStr="";if(!useCache||this.dsCacheMap.get(dataLsKey)==null){for(var x=0;x<array.length;x++){tmp=array[x];tmpAppendStr+=tmpOption.val(tmp["value"]).prop("title",tmp["desc"]).text(tmp["desc"]).prop("outerHTML")}this.dsCacheMap.put(dataLsKey,tmpAppendStr)}else{tmpAppendStr=this.dsCacheMap.get(dataLsKey)}tmpObj.append(tmpAppendStr);tmpObj.attr("fromds","true");tmpObj.val(tmpObj.selectValue);tmpObj.prop("title",tmpObj.children("option:selected").text());tmpObj.change(function(){$(this).prop("title",$(this).children("option:selected").text())})}else{tmpObj.removeAttr("dataLs");var map=new HashMap;var valArr=eval(tmpObj.selectValue);for(var y=0;y<valArr.length;y++){map.put(valArr[y],null)}var tmpAppendStr="";for(var x=0;x<array.length;x++){if(map.containsKey(array[x].value)){tmpAppendStr+=tmpOption.val(array[x].value).prop("title",array[x].desc).text(array[x].desc).prop("outerHTML")}}tmpObj.append(tmpAppendStr)}var loadedCallBack=eval(tmpObj.attr("loadedCallBack"));if(loadedCallBack!=undefined&&typeof loadedCallBack==="function"){loadedCallBack(this,tmpObj)}}else if(tmpObj.get(0).tagName=="INPUT"){var parentNode=null;if(tmpObj.attr("type")=="radio"&&tmpObj.attr("dataLs")!=undefined){tmpObj.removeAttr("dataLs");tmpObj.attr("fromds","true");var regionAttr=tmpObj.attr("region-attr");tmpObj.attr("name",regionAttr+this.regionId);var replaceTxt="";var nodeClass=tmpObj.attr("class");var parentNode=tmpObj.parent();for(var x=0;x<array.length;x++){tmpObj.attr("value",array[x].value);parentNode.attr("desc",array[x].desc);replaceTxt+=parentNode.prop("outerHTML")}var selectValue=tmpObj.selectValue;parentNode=tmpObj.parent().parent();tmpObj.parent().replaceWith(replaceTxt);for(var x=0;x<parentNode.children().length;x++){var tmpNode=parentNode.children()[x];$(tmpNode).append('<span class="'+nodeClass+'">'+$(tmpNode).attr("desc")+"</span>")}if(selectValue!=undefined&&selectValue!=""){var tmpRadio=this.find("input:radio[region-attr="+regionAttr+"][value="+selectValue+"]");if(tmpRadio!=null)tmpRadio.attr("checked","true")}}else if(tmpObj.attr("type")=="checkbox"&&tmpObj.attr("dataLs")!=undefined){tmpObj.removeAttr("dataLs");tmpObj.attr("fromds","true");var regionAttr=tmpObj.attr("region-attr");tmpObj.attr("name",regionAttr);var replaceTxt="";var nodeClass=tmpObj.attr("class");var parentNode=tmpObj.parent();for(var x=0;x<array.length;x++){tmpObj.attr("value",array[x].value);parentNode.attr("desc",array[x].desc);parentNode.attr("val",array[x].value);replaceTxt+=parentNode.prop("outerHTML")}var selectValObj=new Object;if(tmpObj.selectValue!=undefined&&tmpObj.selectValue!=""){var valsArray=JSON.parse(tmpObj.selectValue);for(var j=0;j<valsArray.length;j++){selectValObj[valsArray[j]]=true}}parentNode=tmpObj.parent().parent();tmpObj.parent().replaceWith(replaceTxt);for(var x=0;x<parentNode.children().length;x++){var tmpNode=parentNode.children()[x];$(tmpNode).append('<span class="'+nodeClass+'">'+$(tmpNode).attr("desc")+"</span>");var checkBoxObj=$(tmpNode).find("input[type=checkbox]");var tmpVal=checkBoxObj.attr("value");if(tmpVal!=undefined&&tmpVal!=""){if(selectValObj[tmpVal]){checkBoxObj.prop("checked","true")}}}}var loadedCallBack=eval(tmpObj.attr("loadedCallBack"));if(loadedCallBack!=undefined&&typeof loadedCallBack==="function")loadedCallBack(this,parentNode)}else{for(var x=0;x<array.length;x++){if(array[x].value==tmpObj.selectValue){tmpObj.text(array[x].desc);break}}}this.addRegionId(tmpObj);refreshMessage(tmpObj)};RegionForm.prototype.reRenderDataLs=function(e){for(var t=0;t<e.length;t++){var a=e[t];var i={};i.indexNo=t;i.entityClass=a.attr("entityClass");i.filterVal=a.attr("dataLs");i.filterColumn=a.attr("filterColumn");i.optionLabel=a.attr("optionLabel");i.optionValue=a.attr("optionValue");i.orderBy=a.attr("orderBy");var r=a.attr("dataLs");if(r.indexOf("Country")!=-1){r="Country"}var n=DropdownList.get(r);if(n!=null){var o=new Array;for(var s=0;s<n.length;s++){var l={};l.indexNo=t;for(tmpAttr in n[s]){l.desc=n[s][tmpAttr];l.value=tmpAttr}o.push(l)}this.initDataLsWithArray(e,o)}else{Region.ajaxRequestJson(this,backendPath+"/common/select/getOptions","POST",i,this.initDataLsCallback.bind(this,e),true,null)}}};RegionForm.prototype.hide=function(){this.regionDivObj.addClass("hide")};RegionForm.prototype.show=function(){this.regionDivObj.removeClass("hide")};function FieldError(e,t,a,i,r){this.regionAttribute=e;this.errorDivId=t;this.errorMsg=a;this.inputForm=i;this.labelTxt=r}FieldError.prototype.showErrorMsg=function(){var e=this.inputForm.getDomObjByBindAttribute(this.regionAttribute)};FieldError.prototype.cleanErrorMsg=function(){var e=this.inputForm.getDomObjByBindAttribute(this.regionAttribute)};var region_form_util={renderDataComplete:function(){if(typeof this.afterRenderData==="function"){if(Region.debugMode)console.log(this.regionId+":afterRenderData");this.afterRenderData()}if(window.regionDef==undefined){window.regionDef=new Object}if(Region.debugMode)console.log(this.regionId+":resolve afterRenderData def");var e=window.regionDef["afterRenderData_"+this.regionId];if(e!=null){e.resolve(this);window.regionDef["afterRenderData_"+this.regionId]=null}refreshMessage(this.regionDivObj);this.hideLoading()}};function RequestData(){this.currentPageNo=0;this.totalPageAmount=0;this.totalAmount=0;this.pageNumberBtns=0;this.deleteIds=null;this.deleteId=null}function RegionGrid(e,t,a,i,r){this.paraMap=Region.getUrlParaMap();Region.wrapRegionGridParas(e,this.paraMap);if(!isEmpty(this.paraMap.get("region-id"))){r=this.paraMap.get("region-id")}else if(isEmpty(r)){r=getUUID()}else{r=r.trim()}if(window.regions==undefined){window.regions=new Object}window.regions["region_grid_"+r]=this;this.regionId=r;this.regionDivObj=$(e);this.regionDivObj.attr("id","region-grid-"+this.regionId);$('<div class="loadIcon"><div class="spin-loading spin-sm hide"></div></div>').insertBefore(this.regionDivObj.children()[0]);this.requestData=new RequestData;this.formParas=t;this.regArray=a;this.errorMsgArray=i;this.validationErrors=new HashMap;this.jsonDataBakup=null;this.jsonData=null;var n=this;if(this.regionDivObj.find(".searchImg").length>0&&this.regionDivObj.find(".searchDiv").length>0){this.regionDivObj.find(".searchImg").click(function(){n.toggleSearch()})}this.regionDivObj.find(".addImg").click(function(){var e=n.find(".parameter");var t=new HashMap;t.put("refreshRegions","region_grid_"+$(event.target).attr("region-id"));for(var a=0;a<e.length;a++){var i=e[a];if($(i).attr("region-id")!=n.regionId){continue}t.put($(i).attr("parameter"),$(i).val())}n.addRecordWithMap(t)});this.regionDivObj.find(".searchBtn").click(function(){n.search()});this.regionDivObj.find(".close").click(function(){n.toggleSearch()});this.regionDivObj.find(".resetBtn").click(function(){n.resetForm()});this.regionDivObj.find(".batchDeletebtn").click(function(){n.batchDelete()});this.regionDivObj.find(".updateDtColumn").click(function(){if(n.requestData.orderBy=="updateDt desc"){n.requestData.orderBy="updateDt asc";$(this).find(".dmcaret").attr("class","amcaret")}else{n.requestData.orderBy="updateDt desc";$(this).find(".amcaret").attr("class","dmcaret")}n.refreshPage()}).css("cursor","pointer");this.regionDivObj.find(".createDtColumn").click(function(){if(n.requestData.orderBy=="createDt desc"){n.requestData.orderBy="createDt asc";$(this).find(".dmcaret").attr("class","amcaret")}else{n.requestData.orderBy="createDt desc";$(this).find(".amcaret").attr("class","dmcaret")}n.refreshPage()}).css("cursor","pointer");var o=this.regionDivObj.find(".listTable");o.find(".selectAll").change(function(){if($(this).is(":checked")){o.find("tr").not(".dynamicTD").find(".deleteCbs").prop("checked",true)}else{o.find("tr").not(".dynamicTD").find(".deleteCbs").prop("checked",false)}});collapseToggle(this.regionDivObj);this.addRegionId(this.regionDivObj)}RegionGrid.prototype.find=function(e){return this.regionDivObj.find(e)};RegionGrid.prototype.hide=function(){this.regionDivObj.hide()};RegionGrid.prototype.show=function(){this.regionDivObj.show()};RegionGrid.prototype.addRecordWithMap=function(e){var t=e.keySet();var a="";if(t.length!=0){a="?";for(var i=0;i<t.length;i++){a+=t[i]+"="+e.get(t[i]);if(i<t.length-1){a+="&"}}}openModalWindow(frontEndPath+this.reqPage+a,this.addTitle,this.popupSize,this.hasSpecialHeader,this.customSize)};RegionGrid.prototype.viewRecord=function(e,t){openModalWindow(frontEndPath+this.reqPage+"?recordId="+e+"&refreshRegions="+t,this.viewTitle,this.popupSize,this.hasSpecialHeader,this.customSize)};RegionGrid.prototype.attachRecord=function(e,t){var a=frontEndPath+this.reqAttachPage+"?recordId="+e+"&refreshRegions="+t;if(this.paraMap.get("project")!=undefined){a=a+"&project="+this.paraMap.get("project")}if(this.paraMap.get("module")!=undefined){a=a+"&module="+this.paraMap.get("module")}if(this.paraMap.get("category")!=undefined){a=a+"&category="+this.paraMap.get("category")}if(this.paraMap.get("minsize")!=undefined){a=a+"&minsize="+this.paraMap.get("minsize")}if(this.paraMap.get("maxsize")!=undefined){a=a+"&maxsize="+this.paraMap.get("maxsize")}if(this.paraMap.get("accept")!=undefined){a=a+"&accept="+this.paraMap.get("accept")}openModalWindow(a,this.addTitle,this.popupSize,this.hasSpecialHeader,this.customSize)};RegionGrid.prototype.getRequestData=function(){return this.requestData};RegionGrid.prototype.prePage=function(){this.requestData.deleteIds=null;this.requestData.deleteId=null;if(this.requestData.currentPageNo<=1)return;this.retrivePage(this.requestData.currentPageNo-1)};RegionGrid.prototype.nextPage=function(){this.requestData.deleteIds=null;this.requestData.deleteId=null;this.retrivePage(this.requestData.currentPageNo+1)};RegionGrid.prototype.gotoPage=function(e,t){this.requestData.deleteIds=null;this.requestData.deleteId=null;this.retrivePage(e,t)};RegionGrid.prototype.retrivePage=function(e,t){if(Region.debugMode)console.log(this.regionId+":beforeRetrieveData");if(typeof this.beforeRetrivePage==="function"){this.beforeRetrivePage()}if(e<1){e=1}else if(e>this.requestData.totalPageAmount){e=this.requestData.totalPageAmount}var a=clone(this.requestData);a.currentPageNo=e;if(t!=undefined){this.searchCallBack(t);return}if(this.listRes!=null){if(!coverPageShow)this.find(".gridLoadDiv").removeClass("hide");var i=backendPath+this.listRes;var r=this.searchCallBack.bind(this);Region.ajaxRequestJson(this,i,"GET",a,r,true,null)}else{alert("listRes is empty");this.find(".gridLoadDiv").addClass("hide")}};RegionGrid.prototype.redirectPage=function(){this.gotoPage(this.regionDivObj.find(".goPageId").val())};RegionGrid.prototype.toggleSearch=function(){if(this.regionDivObj.find(".searchDiv").hasClass("hide")){this.regionDivObj.find(".searchDiv").removeClass("hide")}else if(this.regionDivObj.find(".searchDiv").hasClass("hidden")){this.regionDivObj.find(".searchDiv").removeClass("hidden")}else{this.regionDivObj.find(".searchDiv").addClass("hide")}};RegionGrid.prototype.searchCallBack=function(e,t,a){if(Region.debugMode)console.log(this.regionId+":afterRetrieveData");if(!e.success){if(e.msg!=null&&e.msg.trim()!="")alert(e.msg);return}this.jsonData=e.data;if(Region.debugMode)console.log(this.regionId+":beforeRenderData");if(typeof this.beforeRenderData==="function")this.beforeRenderData();console.log(this.jsonData);this.requestData.currentPageNo=this.jsonData.currentPageNo;this.requestData.totalPageAmount=this.jsonData.totalPageAmount;this.requestData.totalAmount=this.jsonData.totalAmount;this.requestData.orderBy=this.jsonData.orderBy;this.requestData.pageSize=this.jsonData.pageSize;this.requestData.deleteIds=null;this.requestData.deleteId=null;this.renderData();if(typeof this.searchSuccessCallBack==="function"){this.searchSuccessCallBack()}};RegionGrid.prototype.renderData=function(){if(this.inputForm!=null){this.inputForm.renderData()}renderPaginationControl(this,this.regionDivObj.find(".pagenationControl"),this.requestData.totalAmount,this.requestData.currentPageNo,this.requestData.totalPageAmount,this.requestData.pageSize);var e=this.jsonData;if(e.totalAmount!=0){this.regionDivObj.find(".norecordmsg").hide();this.regionDivObj.find(".listTable").removeClass("hide");this.regionDivObj.find(".listTable").find("tr").removeClass("hide");this.regionDivObj.find(".listTable").find(".dynamicTD").addClass("hide");this.regionDivObj.find(".batchDeletebtn").show()}else{this.regionDivObj.find(".batchDeletebtn").hide();this.regionDivObj.find(".listTable").addClass("hide");this.regionDivObj.find(".norecordmsg").show()}var t=this.regionDivObj.find(".listTable");this.renderTableList(t,e);if(this.jsonData.msg!=null&&this.jsonData.msg.trim()!="")console.log(jsonData.msg);this.find(".gridLoadDiv").addClass("hide");this.addRegionId(this.regionDivObj);if(Region.debugMode)console.log(this.regionId+":resolve afterRenderData def");if(typeof this.afterRenderData==="function")this.afterRenderData();refreshMessage(this.regionDivObj);this.find(".listTable").show()};RegionGrid.prototype.addRegionId=function(e){Region.addRegionUniqueId(e,this.regionId)};RegionGrid.prototype.renderTableList=function(e,t){fillTable(e,t,this.requestData.currentPageNo,this.requestData.pageSize)};RegionGrid.prototype.dummySearch=function(e){if(typeof this.beforeRetrieveData==="function"){this.beforeRetrieveData()}if(this.inputForm!=null){if(!this.inputForm.validate())return;var t=this.inputForm.packFormData();for(x in t){this.requestData[x]=t[x]}}this.gotoPage(1,e)};RegionGrid.prototype.search=function(){if(typeof this.beforeRetrieveData==="function"){this.beforeRetrieveData()}var e=new Object;this.packageNode(this.regionDivObj,this.regionId,e,"region-searchable");for(x in e){this.requestData[x]=e[x]}this.gotoPage(1)};RegionGrid.prototype.packageNode=function(e,t,a,i){var r=e.attr("region-id");if(r==undefined){if(e.attr("region-url")!=undefined){return}}else if(r!=t){return}var n=e.attr("region-attr");if(n!=undefined&&e.hasClass(i)&&n!=""&&n!="none"){this.packageAttribute(e,a,n)}var o=e.children();for(var s=0;s<o.length;s++){this.packageNode($(o[s]),t,a,i)}};RegionGrid.prototype.packageAttribute=function(e,t,a){if(e.attr("type")=="radio"){if(e.attr("checked")=="checked"){t[a]=e.val()}}else if(e.attr("type")=="checkbox"){if(e.attr("checked")=="checked"){var i=t[a];var r=null;if(i==null||i.trim()==""){r=new Array}else{r=JSON.parse(i)}r.push(e.val());t[a]=JSON.stringify(r)}}else if(e.get(0).tagName=="INPUT"&&e.attr("type")=="file"){t[a]=e.get(0).files[0].name}else{if(e.get(0).tagName=="SELECT"&&e.attr("multiple")){var n=new Array;e.find("> option").each(function(e,t){n.push($(t).val())});t[a]=JSON.stringify(n)}else{var o="";var s=typeof e.val();if(s=="string"){o=e.val().trim()}else if(s==undefined){}else{o=JSON.stringify(e.val())}if(o!=""){t[a]=o}else{t[a]=null}}}};RegionGrid.prototype.resetForm=function(){var e=this.regionDivObj.find("[region-attr]");for(var t=0;t<e.length;t++){var a=$(e[t]);if(a.hasClass("region-searchable")){a.val("")}}setUrlParametersToBindAttr(this.regionDivObj,this.paraMap);this.search()};RegionGrid.prototype.refreshPage=function(){this.requestData.deleteIds=null;this.requestData.deleteId=null;this.retrivePage(this.requestData.currentPageNo)};RegionGrid.prototype.deleteData=function(e){this.highlightDeleteRecord(e);this.requestData.deleteId=e;if(this.deleteMsg==undefined){this.deleteMsg="global_msg.confirm_to_delete_single"}var t=this;setTimeout(function(){if(confirm(getMsg(t.deleteMsg))){var e=t.retrivePage(t.requestData.currentPageNo);if(t.deleteCallBack0!=undefined&&typeof t.deleteCallBack0==="function"){e.done(function(){t.deleteCallBack0()})}return}t.removeHighDeleteRecord(t.requestData.deleteId);t.requestData.deleteId=null},100)};RegionGrid.prototype.highlightDeleteRecord=function(e){var t=this.regionDivObj.find(".listTable").find("tr");for(var a=0;a<t.length;a++){if($(t[a]).attr("primaryKey")==e){$(t[a]).addClass("darklight");break}else{}}};RegionGrid.prototype.removeHighDeleteRecord=function(e){var t=this.regionDivObj.find(".listTable").find("tr");for(var a=0;a<t.length;a++){if($(t[a]).attr("primaryKey")==e){$(t[a]).removeClass("darklight");break}else{}}};RegionGrid.prototype.batchDelete=function(){var e="";var t=this.regionDivObj.find(".listTable").find(".deleteCbs");var a=false;$.each(t,function(t,i){if(i.checked){a=true;e+=i.name+";"}});if(a){this.requestData.deleteIds=e;var i=this;setTimeout(function(){if(confirm(getMsg("global_msg.confirm_to_delete"))){var e=i.retrivePage(i.requestData.currentPageNo);if(i.deleteCallBack0!=undefined&&typeof i.deleteCallBack0==="function"){e.done(function(){i.deleteCallBack0()})}return}i.requestData.deleteIds=null},100)}else{alert(getMsg("global_msg.no_item_selected"))}};RegionGrid.prototype.toggleDetail=function(){console.log(this)};